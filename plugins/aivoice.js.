/*
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’ƒ ğ—™ğ—˜ğ— ğ—”ğ—Ÿğ—˜ ğ—¨ğ—¥ğ——ğ—¨ ğ—©ğ—¢ğ—œğ—–ğ—˜ ğ—–ğ—¢ğ— ğ— ğ—”ğ—¡ğ—— ğŸ™ï¸
âœ¨ Powered by ğ‘ğ€ğ‡ğŒğ€ğ-ğŒğƒ ğŸ’«
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
*/

const { cmd } = require('../command');
const axios = require('axios');
const fs = require('fs');
const path = require('path');

// ğŸ”‘ Apni ElevenLabs API key (use .env for safety)
const ELEVEN_API_KEY = "sk_9c9984fa12461277643e9f862713ec5a46b21161dc439711";

// ğŸŒ¸ Female Urdu model voice
const VOICE_ID = "21m00Tcm4TlvDq8ikWAM";
const MODEL_ID = "eleven_multilingual_v2";

cmd({
    pattern: "voiceurdu",
    alias: ["urduvoice", "aivoice"],
    desc: "Convert Urdu/Roman Urdu text to Female AI Voice ğŸ™ï¸",
    category: "AI",
    react: "ğŸ’ƒ",
    filename: __filename
},
async (conn, mek, m, { text }) => {
    if (!text) return m.reply("ğŸ’¬ *Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§Ø±Ø¯Ùˆ Ù…ÛŒÚº Ú©ÙˆØ¦ÛŒ Ø¬Ù…Ù„Û Ù„Ú©Ú¾ÛŒÚº!*\nÙ…Ø«Ø§Ù„: `.voiceurdu Ø¢Ù¾ Ú©ÛŒØ³Û’ ÛÛŒÚºØŸ`");

    try {
        const tempDir = path.join(__dirname, "../temp");
        if (!fs.existsSync(tempDir)) fs.mkdirSync(tempDir);

        const filePath = path.join(tempDir, `urdu-${Date.now()}.mp3`);

        // ğŸ§  ElevenLabs API request
        const response = await axios({
            method: "POST",
            url: `https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`,
            headers: {
                "xi-api-key": ELEVEN_API_KEY,
                "Content-Type": "application/json",
                "Accept": "audio/mpeg"
            },
            data: {
                text,
                model_id: MODEL_ID,
                voice_settings: {
                    stability: 0.55,
                    similarity_boost: 0.9
                }
            },
            responseType: "arraybuffer"
        });

        fs.writeFileSync(filePath, response.data);

        const caption = `
â•­â”€â”€ğŸ™ï¸ *AI Urdu Female Voice*
â”‚ğŸ’¬ ${text}
â”‚
â”‚âœ¨ *Powered by Rahman-md ğŸ’«*
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`;

        await conn.sendMessage(
            m.chat,
            {
                audio: fs.readFileSync(filePath),
                mimetype: "audio/mpeg",
                ptt: true,
                caption,
            },
            { quoted: m }
        );

        fs.unlinkSync(filePath);

    } catch (err) {
        console.error("ElevenLabs Error:", err.response?.data || err.message);
        m.reply("âŒ *Error:* Urdu Female voice generate Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ÛŒÛ”\nØ§Ù¾Ù†ÛŒ API key Ú†ÛŒÚ© Ú©Ø±ÛŒÚºÛ”");
    }
});